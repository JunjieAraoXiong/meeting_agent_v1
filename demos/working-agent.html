<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>会议助手 - Meeting Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif; }
        .segment { padding: 12px; margin: 8px 0; border: 1px solid #e5e7eb; border-radius: 8px; }
        .revealed { background: white; opacity: 1; }
        .hidden { background: #f9f9f9; opacity: 0.5; }
        .highlight { background: #fef3c7; padding: 2px 4px; border-radius: 4px; cursor: pointer; font-weight: 500; }
    </style>
</head>
<body class="bg-gray-50 p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-bold mb-4">🎯 会议助手 - Meeting Agent</h1>
        
        <div class="bg-white rounded-lg p-4 mb-4 shadow">
            <div class="flex gap-2 mb-4">
                <button onclick="playPause()" id="playBtn" class="px-4 py-2 bg-green-500 text-white rounded">▶️ 播放</button>
                <button onclick="reset()" class="px-4 py-2 bg-gray-500 text-white rounded">🔄 重置</button>
                <button onclick="showPasteModal()" class="px-4 py-2 bg-blue-500 text-white rounded">📋 粘贴</button>
            </div>
            <div class="flex items-center gap-2">
                <span id="currentTime">0:00</span>
                <input type="range" id="timeline" min="0" max="300" value="0" class="flex-1" oninput="seek(this.value)">
                <span id="maxTime">5:00</span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div class="lg:col-span-2 bg-white rounded-lg p-4 shadow">
                <h2 class="text-lg font-semibold mb-3">📜 会议转录</h2>
                <div id="transcript" class="space-y-2 max-h-96 overflow-y-auto">
                    <!-- Content will be added here -->
                </div>
            </div>
            
            <div class="bg-white rounded-lg p-4 shadow">
                <h2 class="text-lg font-semibold mb-3">📖 关键术语</h2>
                <div id="selectedTerm" class="text-blue-600 font-semibold mb-2">点击术语查看定义</div>
                <div id="termDef" class="text-gray-600 text-sm mb-4">术语会随会议进度显示</div>
                <div id="terms" class="flex flex-wrap gap-1">
                    <!-- Terms will be added here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl m-4">
            <h3 class="text-lg font-semibold mb-4">📋 粘贴转录文本</h3>
            <textarea id="pasteText" class="w-full h-64 border rounded p-3" placeholder="在此粘贴转录文本...

格式:
汤欣钰 00:00
内容...

说话人 1 01:30
更多内容..."></textarea>
            <div class="flex justify-end gap-2 mt-4">
                <button onclick="closeModal()" class="px-4 py-2 bg-gray-300 rounded">取消</button>
                <button onclick="loadPastedText()" class="px-4 py-2 bg-blue-500 text-white rounded">加载</button>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const sampleText = `汤欣钰 00:00
猫戴在身上，然后又有定位，又有糖包与翻译。嗯，去年好像就有这个，好像就有一个，去年好像有一个类似的，就是也戴在什么身上啊？狗啊？对啊，那个网站的哪里啊？那个有没有总的那个 list？

汤欣钰 00:56
然后，嗯，要不然我们先说，嗯，就明天，不是还是下午有那个周会嘛？嗯，对，就大家最近有没有什么困难？然后以及有没有识别到什么机会、想法的？

汤欣钰 01:36
对，我看这个黑马项目他们都有在全捷 OA 上部署一些 1.5B 的端观测模型。嗯，完全是比我们这个参数量要大得多，然后好像还行，那可以联系下他们，是吧？

汤欣钰 02:04
你这个知道，然后我再问一下这边的 Buzz，是吧？然后我也留了。那个还有没有什么困难啊？有没有大家觉得遇到一些困难的？对。嗯，有个比较大的困难，就跟上头聊的那个隐私模式，其实感觉没有特别好的思路。`;

        let segments = [];
        let currentIndex = -1;
        let isPlaying = false;
        let playInterval;
        let allTerms = [];

        function parseTime(timeStr) {
            const [min, sec] = timeStr.split(':').map(Number);
            return min * 60 + sec;
        }

        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            return `${min}:${sec.toString().padStart(2, '0')}`;
        }

        function parseTranscript(text) {
            const lines = text.split('\n').filter(line => line.trim());
            const result = [];
            const speakerPattern = /^(.+?)\s+(\d{1,2}:\d{2})$/;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                const match = line.match(speakerPattern);
                
                if (match) {
                    const speaker = match[1];
                    const time = match[2];
                    const timeSeconds = parseTime(time);
                    
                    let content = '';
                    let j = i + 1;
                    while (j < lines.length && !lines[j].match(speakerPattern)) {
                        if (content) content += ' ';
                        content += lines[j].trim();
                        j++;
                    }
                    
                    if (content) {
                        result.push({ speaker, time, timeSeconds, content, index: result.length });
                    }
                    i = j - 1;
                }
            }
            return result;
        }

        function extractTerms(segments) {
            const terms = new Set();
            segments.forEach(seg => {
                // Find Chinese technical terms
                const matches = seg.content.match(/([\u4e00-\u9fa5]{2,4})(项目|模型|模式|系统|平台|算法|方案|产品|设备|眼镜|手环|录音)/g);
                if (matches) matches.forEach(term => terms.add(term));
                
                const techMatches = seg.content.match(/(\d+\.?\d*[BM]?)\s*(模型|参数|版本)/g);
                if (techMatches) techMatches.forEach(term => terms.add(term));
                
                const brandMatches = seg.content.match(/\b(Meta|Google|谷歌|苹果|小米|雷朋|Buzz|OA)\b/gi);
                if (brandMatches) brandMatches.forEach(term => terms.add(term));
            });
            return Array.from(terms);
        }

        function highlightTerms(text) {
            let result = text;
            allTerms.forEach(term => {
                const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                result = result.replace(regex, `<span class="highlight" onclick="selectTerm('$1')">$1</span>`);
            });
            return result;
        }

        function selectTerm(term) {
            document.getElementById('selectedTerm').textContent = term;
            document.getElementById('termDef').textContent = `定义: ${term} - 这是会议中提到的重要术语`;
        }

        function renderTranscript() {
            const container = document.getElementById('transcript');
            container.innerHTML = '';
            
            segments.forEach((seg, index) => {
                const div = document.createElement('div');
                div.className = `segment ${index <= currentIndex ? 'revealed' : 'hidden'}`;
                
                const highlightedContent = highlightTerms(seg.content);
                
                div.innerHTML = `
                    <div class="text-xs text-gray-500 mb-1">
                        <span class="font-mono">${seg.time}</span>
                        <span class="ml-2 px-2 py-1 bg-gray-100 rounded text-xs">${seg.speaker}</span>
                    </div>
                    <div class="text-sm">${highlightedContent}</div>
                `;
                container.appendChild(div);
            });
        }

        function renderTerms() {
            const container = document.getElementById('terms');
            container.innerHTML = '';
            
            allTerms.forEach(term => {
                const button = document.createElement('button');
                button.className = 'text-xs px-2 py-1 bg-gray-100 rounded hover:bg-gray-200';
                button.textContent = term;
                button.onclick = () => selectTerm(term);
                container.appendChild(button);
            });
        }

        function playPause() {
            const btn = document.getElementById('playBtn');
            if (isPlaying) {
                clearInterval(playInterval);
                btn.textContent = '▶️ 播放';
                btn.className = 'px-4 py-2 bg-green-500 text-white rounded';
            } else {
                playInterval = setInterval(() => {
                    if (currentIndex < segments.length - 1) {
                        currentIndex++;
                        renderTranscript();
                        updateTimeline();
                    } else {
                        playPause();
                    }
                }, 2000);
                btn.textContent = '⏸️ 暂停';
                btn.className = 'px-4 py-2 bg-red-500 text-white rounded';
            }
            isPlaying = !isPlaying;
        }

        function reset() {
            if (isPlaying) playPause();
            currentIndex = -1;
            renderTranscript();
            updateTimeline();
        }

        function updateTimeline() {
            const timeline = document.getElementById('timeline');
            const currentTime = document.getElementById('currentTime');
            
            if (segments.length > 0) {
                const maxTime = segments[segments.length - 1].timeSeconds;
                timeline.max = maxTime;
                document.getElementById('maxTime').textContent = formatTime(maxTime);
                
                if (currentIndex >= 0) {
                    timeline.value = segments[currentIndex].timeSeconds;
                    currentTime.textContent = formatTime(segments[currentIndex].timeSeconds);
                } else {
                    timeline.value = 0;
                    currentTime.textContent = '0:00';
                }
            }
        }

        function seek(value) {
            const targetTime = parseInt(value);
            currentIndex = segments.findIndex(seg => seg.timeSeconds > targetTime) - 1;
            if (currentIndex < 0) currentIndex = segments.length - 1;
            renderTranscript();
            document.getElementById('currentTime').textContent = formatTime(targetTime);
        }

        function showPasteModal() {
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('modal').classList.remove('flex');
        }

        function loadPastedText() {
            const text = document.getElementById('pasteText').value;
            if (text.trim()) {
                loadTranscript(text);
            }
            closeModal();
        }

        function loadTranscript(text) {
            segments = parseTranscript(text);
            allTerms = extractTerms(segments);
            reset();
            renderTerms();
            console.log('Loaded transcript:', segments.length, 'segments');
        }

        // Initialize
        function init() {
            console.log('Initializing...');
            loadTranscript(sampleText);
        }

        // Start when page loads
        window.onload = init;
    </script>
</body>
</html>


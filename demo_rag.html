<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Meet RAG System Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif; 
        }
        .loading-dots {
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0%, 20% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 max-w-4xl">
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ¤– E-Meet RAG System Demo</h1>
                <p class="text-gray-600">Intelligent Meeting Search & Analysis</p>
            </div>

            <!-- Quick Test Section -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <h2 class="text-lg font-semibold text-blue-800 mb-3">ğŸš€ Quick Test</h2>
                <p class="text-blue-700 text-sm mb-3">
                    This demo tests the RAG system with sample meeting data. Click "Run Demo" to see intelligent search in action!
                </p>
                <div class="flex gap-2">
                    <button onclick="runDemo()" id="demoBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        ğŸ¯ Run Demo
                    </button>
                    <button onclick="clearResults()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                        ğŸ—‘ï¸ Clear
                    </button>
                </div>
            </div>

            <!-- Status Panel -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-white border rounded-lg p-4">
                    <div class="text-sm text-gray-600">Vector Count</div>
                    <div id="vectorCount" class="text-2xl font-bold text-blue-600">0</div>
                </div>
                <div class="bg-white border rounded-lg p-4">
                    <div class="text-sm text-gray-600">Processing Status</div>
                    <div id="status" class="text-lg font-medium text-gray-800">Ready</div>
                </div>
                <div class="bg-white border rounded-lg p-4">
                    <div class="text-sm text-gray-600">Last Query Time</div>
                    <div id="queryTime" class="text-lg font-medium text-green-600">-</div>
                </div>
            </div>

            <!-- Test Queries -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <h3 class="text-lg font-semibold mb-3">ğŸ¯ Try These Test Queries</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    <button onclick="testQuery('é»‘é©¬é¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿ')" class="text-left p-3 bg-white border rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors">
                        <div class="font-medium">é»‘é©¬é¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿ</div>
                        <div class="text-sm text-gray-600">Project information query</div>
                    </button>
                    <button onclick="testQuery('ä¼šè®®ä¸­æåˆ°äº†ä»€ä¹ˆå›°éš¾ï¼Ÿ')" class="text-left p-3 bg-white border rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors">
                        <div class="font-medium">ä¼šè®®ä¸­æåˆ°äº†ä»€ä¹ˆå›°éš¾ï¼Ÿ</div>
                        <div class="text-sm text-gray-600">Problem identification</div>
                    </button>
                    <button onclick="testQuery('è°æåˆ°äº†éšç§æ¨¡å¼ï¼Ÿ')" class="text-left p-3 bg-white border rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors">
                        <div class="font-medium">è°æåˆ°äº†éšç§æ¨¡å¼ï¼Ÿ</div>
                        <div class="text-sm text-gray-600">Speaker identification</div>
                    </button>
                    <button onclick="testQuery('1.5Bæ¨¡å‹çš„å‚æ•°é‡å¦‚ä½•ï¼Ÿ')" class="text-left p-3 bg-white border rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors">
                        <div class="font-medium">1.5Bæ¨¡å‹çš„å‚æ•°é‡å¦‚ä½•ï¼Ÿ</div>
                        <div class="text-sm text-gray-600">Technical details</div>
                    </button>
                </div>
            </div>

            <!-- Results Area -->
            <div id="resultsArea" class="space-y-4">
                <div class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-2">ğŸ¤</div>
                    <p>Click "Run Demo" to start testing the RAG system</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple RAG demo without external dependencies
        class RAGDemo {
            constructor() {
                this.vectors = [];
                this.testData = [
                    {
                        speaker: "æ±¤æ¬£é’°",
                        time: "00:00",
                        text: "çŒ«æˆ´åœ¨èº«ä¸Šï¼Œç„¶ååˆæœ‰å®šä½ï¼Œåˆæœ‰ç³–åŒ…ä¸ç¿»è¯‘ã€‚å—¯ï¼Œå»å¹´å¥½åƒå°±æœ‰è¿™ä¸ªï¼Œå¥½åƒå°±æœ‰ä¸€ä¸ªï¼Œå»å¹´å¥½åƒæœ‰ä¸€ä¸ªç±»ä¼¼çš„ï¼Œå°±æ˜¯ä¹Ÿæˆ´åœ¨ä»€ä¹ˆèº«ä¸Šå•Šï¼Ÿç‹—å•Šï¼Ÿ"
                    },
                    {
                        speaker: "æ±¤æ¬£é’°", 
                        time: "00:56",
                        text: "ç„¶åï¼Œå—¯ï¼Œè¦ä¸ç„¶æˆ‘ä»¬å…ˆè¯´ï¼Œå—¯ï¼Œå°±æ˜å¤©ï¼Œä¸æ˜¯è¿˜æ˜¯ä¸‹åˆæœ‰é‚£ä¸ªå‘¨ä¼šå˜›ï¼Ÿå—¯ï¼Œå¯¹ï¼Œå°±å¤§å®¶æœ€è¿‘æœ‰æ²¡æœ‰ä»€ä¹ˆå›°éš¾ï¼Ÿç„¶åä»¥åŠæœ‰æ²¡æœ‰è¯†åˆ«åˆ°ä»€ä¹ˆæœºä¼šã€æƒ³æ³•çš„ï¼Ÿ"
                    },
                    {
                        speaker: "æ±¤æ¬£é’°",
                        time: "01:36", 
                        text: "å¯¹ï¼Œæˆ‘çœ‹è¿™ä¸ªé»‘é©¬é¡¹ç›®ä»–ä»¬éƒ½æœ‰åœ¨å…¨æ· OA ä¸Šéƒ¨ç½²ä¸€äº› 1.5B çš„ç«¯è§‚æµ‹æ¨¡å‹ã€‚å—¯ï¼Œå®Œå…¨æ˜¯æ¯”æˆ‘ä»¬è¿™ä¸ªå‚æ•°é‡è¦å¤§å¾—å¤šï¼Œç„¶åå¥½åƒè¿˜è¡Œï¼Œé‚£å¯ä»¥è”ç³»ä¸‹ä»–ä»¬ï¼Œæ˜¯å§ï¼Ÿ"
                    },
                    {
                        speaker: "æ±¤æ¬£é’°",
                        time: "02:04",
                        text: "ä½ è¿™ä¸ªçŸ¥é“ï¼Œç„¶åæˆ‘å†é—®ä¸€ä¸‹è¿™è¾¹çš„ Buzzï¼Œæ˜¯å§ï¼Ÿç„¶åæˆ‘ä¹Ÿç•™äº†ã€‚é‚£ä¸ªè¿˜æœ‰æ²¡æœ‰ä»€ä¹ˆå›°éš¾å•Šï¼Ÿæœ‰æ²¡æœ‰å¤§å®¶è§‰å¾—é‡åˆ°ä¸€äº›å›°éš¾çš„ï¼Ÿå¯¹ã€‚å—¯ï¼Œæœ‰ä¸ªæ¯”è¾ƒå¤§çš„å›°éš¾ï¼Œå°±è·Ÿä¸Šå¤´èŠçš„é‚£ä¸ªéšç§æ¨¡å¼ï¼Œå…¶å®æ„Ÿè§‰æ²¡æœ‰ç‰¹åˆ«å¥½çš„æ€è·¯ã€‚"
                    },
                    {
                        speaker: "æ±¤æ¬£é’°",
                        time: "02:55",
                        text: "æˆ‘æ‹¿å¾—åˆ°çš„å“¦ã€‚æˆ‘å·²ç»åœ¨å½•äº†ï¼Œæˆ‘ä¹ŸæŠŠå®ƒæ“ï¼Œæˆ‘çœ‹æˆ‘æŠŠè¿™ä¸ªåˆ†äº«åˆ°ç¾¤é‡Œã€‚"
                    }
                ];
            }

            async indexData() {
                this.updateStatus("Indexing meeting data...");
                
                // Simulate vector generation
                this.vectors = this.testData.map((segment, index) => ({
                    id: index,
                    text: segment.text,
                    speaker: segment.speaker,
                    time: segment.time,
                    embedding: this.generateFakeEmbedding(segment.text)
                }));
                
                this.updateVectorCount(this.vectors.length);
                this.updateStatus("Ready");
                
                await this.delay(500); // Simulate processing time
            }

            generateFakeEmbedding(text) {
                // Simple hash-based embedding for demo
                const words = text.match(/[\w\u4e00-\u9fa5]+/g) || [];
                const embedding = new Array(384).fill(0);
                
                words.forEach((word, i) => {
                    const hash = this.simpleHash(word);
                    for (let j = 0; j < 5; j++) {
                        const index = (hash + j) % 384;
                        embedding[index] += 0.1;
                    }
                });
                
                // Normalize
                const norm = Math.sqrt(embedding.reduce((sum, val) => sum + val * val, 0));
                return norm > 0 ? embedding.map(val => val / norm) : embedding;
            }

            simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash);
            }

            async search(query) {
                const startTime = performance.now();
                this.updateStatus("Searching...");
                
                // Simple keyword matching for demo
                const keywords = query.match(/[\w\u4e00-\u9fa5]+/g) || [];
                const results = [];
                
                this.vectors.forEach(vector => {
                    let score = 0;
                    keywords.forEach(keyword => {
                        if (vector.text.includes(keyword)) {
                            score += 1;
                        }
                    });
                    
                    if (score > 0) {
                        results.push({
                            ...vector,
                            score: score + Math.random() * 0.3, // Add some randomness
                            similarity: Math.min(0.95, 0.6 + score * 0.1 + Math.random() * 0.2)
                        });
                    }
                });
                
                const endTime = performance.now();
                this.updateQueryTime(`${(endTime - startTime).toFixed(1)}ms`);
                this.updateStatus("Ready");
                
                return results.sort((a, b) => b.score - a.score).slice(0, 3);
            }

            generateAnswer(query, sources) {
                if (sources.length === 0) {
                    return "æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„ä¼šè®®å†…å®¹æ¥å›ç­”æ‚¨çš„é—®é¢˜ã€‚";
                }

                const templates = {
                    "é»‘é©¬é¡¹ç›®": "æ ¹æ®ä¼šè®®è®°å½•ï¼Œé»‘é©¬é¡¹ç›®æ˜¯ä¸€ä¸ªåœ¨å…¨æ· OA ä¸Šéƒ¨ç½² 1.5B ç«¯è§‚æµ‹æ¨¡å‹çš„é¡¹ç›®ã€‚ä¼šè®®ä¸­æåˆ°ä»–ä»¬çš„å‚æ•°é‡æ¯”ç›®å‰ä½¿ç”¨çš„è¦å¤§å¾—å¤šï¼Œæ•ˆæœè¿˜ä¸é”™ï¼Œå»ºè®®å¯ä»¥è”ç³»ä»–ä»¬äº†è§£æ›´å¤šä¿¡æ¯ã€‚",
                    "å›°éš¾": "ä¼šè®®ä¸­æåˆ°äº†å‡ ä¸ªå›°éš¾ï¼š1) éšç§æ¨¡å¼æ²¡æœ‰ç‰¹åˆ«å¥½çš„æ€è·¯ï¼›2) å¼€å‘èµ„æºæ–¹é¢çš„èƒ½åŠ›è¿˜æ¯”è¾ƒçŸ­ç¼ºï¼›3) è¯­éŸ³ç›¸å…³çš„è§£å†³æ–¹æ¡ˆè¿˜éœ€è¦å®Œå–„ã€‚",
                    "éšç§æ¨¡å¼": "æ±¤æ¬£é’°åœ¨ä¼šè®®ä¸­æåˆ°äº†éšç§æ¨¡å¼ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å›°éš¾ï¼Œç›®å‰æ„Ÿè§‰æ²¡æœ‰ç‰¹åˆ«å¥½çš„æ€è·¯ã€‚",
                    "1.5Bæ¨¡å‹": "ä¼šè®®ä¸­æåˆ°é»‘é©¬é¡¹ç›®éƒ¨ç½²çš„æ˜¯ 1.5B å‚æ•°çš„ç«¯è§‚æµ‹æ¨¡å‹ï¼Œå‚æ•°é‡æ¯”ç›®å‰ä½¿ç”¨çš„æ¨¡å‹è¦å¤§å¾—å¤šã€‚"
                };

                // Find matching template
                for (const [key, answer] of Object.entries(templates)) {
                    if (query.includes(key)) {
                        return answer;
                    }
                }

                // Default response with sources
                const sourceText = sources.map(s => `[${s.time}] ${s.speaker}: ${s.text.substring(0, 100)}...`).join('\n\n');
                return `æ ¹æ®ä¼šè®®è®°å½•ï¼Œæˆ‘æ‰¾åˆ°äº†ä»¥ä¸‹ç›¸å…³ä¿¡æ¯ï¼š\n\n${sourceText}`;
            }

            updateStatus(status) {
                document.getElementById('status').textContent = status;
            }

            updateVectorCount(count) {
                document.getElementById('vectorCount').textContent = count;
            }

            updateQueryTime(time) {
                document.getElementById('queryTime').textContent = time;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        const ragDemo = new RAGDemo();

        async function runDemo() {
            const btn = document.getElementById('demoBtn');
            btn.disabled = true;
            btn.innerHTML = 'ğŸ”„ Running...';
            
            try {
                await ragDemo.indexData();
                
                // Show success message
                document.getElementById('resultsArea').innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center gap-2 text-green-800">
                            <span class="text-xl">âœ…</span>
                            <span class="font-semibold">Demo Ready!</span>
                        </div>
                        <p class="text-green-700 mt-1">
                            Successfully indexed ${ragDemo.vectors.length} meeting segments. 
                            Try the test queries below to see intelligent search in action!
                        </p>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('resultsArea').innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="text-red-800 font-semibold">âŒ Demo Failed</div>
                        <p class="text-red-700">${error.message}</p>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ¯ Run Demo';
            }
        }

        async function testQuery(query) {
            const startTime = performance.now();
            
            // Add query to results
            document.getElementById('resultsArea').innerHTML += `
                <div class="bg-white border rounded-lg p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-blue-600">ğŸ‘¤</span>
                        <span class="font-medium">æ‚¨çš„é—®é¢˜:</span>
                    </div>
                    <div class="text-gray-800 mb-4">${query}</div>
                    
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-green-600">ğŸ¤–</span>
                        <span class="font-medium">AI å›ç­”:</span>
                        <span class="loading-dots text-gray-500">æ€è€ƒä¸­...</span>
                    </div>
                    <div id="answer-${Date.now()}" class="text-gray-600">Processing...</div>
                </div>
            `;
            
            try {
                // Simulate processing delay
                await ragDemo.delay(800);
                
                const sources = await ragDemo.search(query);
                const answer = ragDemo.generateAnswer(query, sources);
                
                const endTime = performance.now();
                const processingTime = (endTime - startTime).toFixed(1);
                
                // Update the answer
                const answerElements = document.querySelectorAll('[id^="answer-"]');
                const latestAnswer = answerElements[answerElements.length - 1];
                
                latestAnswer.innerHTML = `
                    <div class="text-gray-800 mb-3">${answer}</div>
                    ${sources.length > 0 ? `
                        <div class="mt-3 pt-2 border-t border-gray-200">
                            <div class="text-sm text-gray-600 mb-2">å¼•ç”¨æ¥æº (${sources.length}):</div>
                            <div class="flex flex-wrap gap-2">
                                ${sources.map(source => `
                                    <div class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded border border-blue-200">
                                        ${source.time} ${source.speaker} (${(source.similarity * 100).toFixed(1)}%)
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    <div class="text-xs text-gray-500 mt-2">
                        å¤„ç†æ—¶é—´: ${processingTime}ms | æ‰¾åˆ° ${sources.length} ä¸ªç›¸å…³ç‰‡æ®µ
                    </div>
                `;
                
                // Remove loading indicator
                const loadingDots = latestAnswer.parentElement.querySelector('.loading-dots');
                if (loadingDots) loadingDots.remove();
                
            } catch (error) {
                console.error('Query failed:', error);
            }
        }

        function clearResults() {
            document.getElementById('resultsArea').innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-2">ğŸ¤</div>
                    <p>Results cleared. Ready for new queries!</p>
                </div>
            `;
        }

        // Auto-run demo when page loads
        window.addEventListener('load', () => {
            setTimeout(runDemo, 1000);
        });
    </script>
</body>
</html>
